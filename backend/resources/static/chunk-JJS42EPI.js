import{a as v,b as D}from"./chunk-RGYFSMI6.js";import{c as u}from"./chunk-MGIYICR7.js";import{F as c,P as h,T as g,X as f,c as d,hc as o,ja as S,l as m,m as k}from"./chunk-I5ELLGFI.js";import{a as r,b as l}from"./chunk-JKOY2XUY.js";var A=(()=>{let a=class a{constructor(){this.delay=500}get(t,e,s){console.log(`MockApiService: GET ${t}`,{params:e,headers:s});let i;return t==="/notifications"?i=[]:t.startsWith("/notifications/")?i={id:"mock-notification-1",title:"Mock Notification",message:"This is a mock notification",type:"info",isRead:!1,timestamp:new Date,link:null}:i={},m(i).pipe(c(this.delay))}post(t,e,s){return console.log(`MockApiService: POST ${t}`,{body:e,headers:s}),m(e).pipe(c(this.delay))}put(t,e,s){return console.log(`MockApiService: PUT ${t}`,{body:e,headers:s}),m(e).pipe(c(this.delay))}delete(t,e){return console.log(`MockApiService: DELETE ${t}`,{headers:e}),m({}).pipe(c(this.delay))}patch(t,e,s){return console.log(`MockApiService: PATCH ${t}`,{body:e,headers:s}),m(e).pipe(c(this.delay))}simulateError(t,e=500){let s={message:t,status:e};return k(()=>s).pipe(c(this.delay))}setDelay(t){this.delay=t}};a.\u0275fac=function(e){return new(e||a)},a.\u0275prov=g({token:a,factory:a.\u0275fac,providedIn:"root"});let p=a;return p})();var L={marketSummary:null,topGainers:null,topLosers:null,mostActive:null,searchResults:null,stockDetails:{},loading:!1,error:null,lastUpdated:{marketSummary:null,topGainers:null,topLosers:null,mostActive:null,searchResults:null,stockDetails:{}}},F=(()=>{let a=class a{get apiService(){return v.useMockData?this.mockApiService:this.realApiService}constructor(t,e){this.realApiService=t,this.mockApiService=e,this.endpoint="/market",this.state=S(L),this.marketSummary=o(()=>this.state().marketSummary),this.topGainers=o(()=>this.state().topGainers),this.topLosers=o(()=>this.state().topLosers),this.mostActive=o(()=>this.state().mostActive),this.searchResults=o(()=>this.state().searchResults),this.stockDetails=o(()=>this.state().stockDetails),this.loading=o(()=>this.state().loading),this.error=o(()=>this.state().error),this.lastUpdated=o(()=>this.state().lastUpdated)}updateState(t){this.state.update(e=>r(r({},e),t))}setLoading(t){this.updateState({loading:t})}setError(t){this.updateState({error:t})}updateTimestamp(t,e){t==="stockDetails"&&e?this.state.update(s=>l(r({},s),{lastUpdated:l(r({},s.lastUpdated),{stockDetails:l(r({},s.lastUpdated.stockDetails),{[e]:new Date})})})):t!=="stockDetails"&&this.state.update(s=>l(r({},s),{lastUpdated:l(r({},s.lastUpdated),{[t]:new Date})}))}getMarketSummary(t=!1){return!t&&this.marketSummary()&&this.lastUpdated().marketSummary&&new Date().getTime()-this.lastUpdated().marketSummary.getTime()<5*60*1e3?new d(s=>{s.next(this.marketSummary()),s.complete()}):(this.setLoading(!0),this.setError(null),this.apiService.get(`${this.endpoint}/summary`).pipe(h({next:e=>{this.updateState({marketSummary:e,loading:!1}),this.updateTimestamp("marketSummary")},error:e=>{this.setLoading(!1),this.setError(e.message||"Failed to load market summary")}})))}getTopGainers(t=10,e=!1){if(!e&&this.topGainers()&&this.lastUpdated().topGainers&&new Date().getTime()-this.lastUpdated().topGainers.getTime()<5*60*1e3)return new d(n=>{n.next(this.topGainers()),n.complete()});this.setLoading(!0),this.setError(null);let s=new u().set("limit",t.toString());return this.apiService.get(`${this.endpoint}/gainers`,s).pipe(h({next:i=>{this.updateState({topGainers:i,loading:!1}),this.updateTimestamp("topGainers")},error:i=>{this.setLoading(!1),this.setError(i.message||"Failed to load top gainers")}}))}getTopLosers(t=10,e=!1){if(!e&&this.topLosers()&&this.lastUpdated().topLosers&&new Date().getTime()-this.lastUpdated().topLosers.getTime()<5*60*1e3)return new d(n=>{n.next(this.topLosers()),n.complete()});this.setLoading(!0),this.setError(null);let s=new u().set("limit",t.toString());return this.apiService.get(`${this.endpoint}/losers`,s).pipe(h({next:i=>{this.updateState({topLosers:i,loading:!1}),this.updateTimestamp("topLosers")},error:i=>{this.setLoading(!1),this.setError(i.message||"Failed to load top losers")}}))}getMostActive(t=10,e=!1){if(!e&&this.mostActive()&&this.lastUpdated().mostActive&&new Date().getTime()-this.lastUpdated().mostActive.getTime()<5*60*1e3)return new d(n=>{n.next(this.mostActive()),n.complete()});this.setLoading(!0),this.setError(null);let s=new u().set("limit",t.toString());return this.apiService.get(`${this.endpoint}/active`,s).pipe(h({next:i=>{this.updateState({mostActive:i,loading:!1}),this.updateTimestamp("mostActive")},error:i=>{this.setLoading(!1),this.setError(i.message||"Failed to load most active stocks")}}))}searchStocks(t){this.setLoading(!0),this.setError(null);let e=new u().set("q",t);return this.apiService.get(`${this.endpoint}/search`,e).pipe(h({next:s=>{this.updateState({searchResults:s,loading:!1}),this.updateTimestamp("searchResults")},error:s=>{this.setLoading(!1),this.setError(s.message||"Failed to search stocks")}}))}getStockDetails(t,e=!1){return!e&&this.stockDetails()[t]&&this.lastUpdated().stockDetails[t]&&new Date().getTime()-this.lastUpdated().stockDetails[t].getTime()<5*60*1e3?new d(i=>{i.next(this.stockDetails()[t]),i.complete()}):(this.setLoading(!0),this.setError(null),this.apiService.get(`${this.endpoint}/stocks/${t}`).pipe(h({next:s=>{this.state.update(i=>l(r({},i),{stockDetails:l(r({},i.stockDetails),{[t]:s}),loading:!1})),this.updateTimestamp("stockDetails",t)},error:s=>{this.setLoading(!1),this.setError(s.message||`Failed to load details for stock ${t}`)}})))}clearCache(){this.state.set(L)}};a.\u0275fac=function(e){return new(e||a)(f(D),f(A))},a.\u0275prov=g({token:a,factory:a.\u0275fac,providedIn:"root"});let p=a;return p})();export{A as a,F as b};
