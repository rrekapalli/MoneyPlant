import{a as ce,c as se}from"./chunk-G6BKS25R.js";import{b as me}from"./chunk-KLL2WT5Y.js";import{a as q,b as D}from"./chunk-5QDLLTGU.js";import"./chunk-NBMXCGLL.js";import{a as te,b as ne,c as re,d as ie,e as oe,f as ae}from"./chunk-ZIWCRGVR.js";import{f as X,g as Z,h as $,i as ee}from"./chunk-E2A6ZCMF.js";import{Ba as U,Ra as J,Sa as K,Z as y,za as z}from"./chunk-IDZOVNAK.js";import"./chunk-6DF6NXBA.js";import{c as N,f as j,g as L,i as A,j as R,k as G,t as Y,v as H}from"./chunk-RSWLFW5Q.js";import{i as B,k as W}from"./chunk-AR7LHXST.js";import{Da as s,Gb as k,Ia as M,Ic as I,Lb as a,Mb as w,Nb as x,Oa as F,P as O,Qb as C,Rb as _,Sb as h,Ta as v,Uc as Q,Vb as V,ca as m,da as l,f as E,jb as u,kb as r,lb as n,mb as b,tb as T,vb as f,xb as S}from"./chunk-53IN4TFO.js";import"./chunk-GAL4ENT6.js";function le(g,p){if(g&1&&(r(0,"span",34),a(1),n()),g&2){let P=S();s(),w(P.criteriaQuery.rules.length)}}function de(g,p){if(g&1&&(r(0,"div",35)(1,"h4"),a(2,"Criteria Preview"),n(),r(3,"div",36)(4,"p")(5,"strong"),a(6,"Total Rules:"),n(),a(7),n(),r(8,"p")(9,"strong"),a(10,"Logic:"),n(),a(11),n(),r(12,"p")(13,"strong"),a(14,"Status:"),n(),r(15,"span",37),a(16,"Active"),n()()()()),g&2){let P=S();s(7),x(" ",P.criteriaQuery.rules.length),s(4),x(" ",P.criteriaQuery.condition.toUpperCase())}}var We=(()=>{let p=class p{constructor(e,i,t,c){this.route=e,this.router=i,this.screenerState=t,this.messageService=c,this.destroy$=new E,this.screener=null,this.loading=!1,this.error=null,this.isEdit=!1,this.screenerForm={name:"",description:"",isPublic:!1,defaultUniverse:"",criteria:void 0},this.activeTab="basic",this.criteriaQuery={condition:"and",rules:[]},this.criteriaConfig={fields:this.getIndicatorFields(),defaultCondition:"and",allowCollapse:!0,allowEmpty:!1}}ngOnInit(){this.initializeSubscriptions(),this.loadScreener()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}initializeSubscriptions(){this.screenerState.currentScreener$.pipe(O(this.destroy$)).subscribe(e=>{this.screener=e,e&&(this.screenerForm={name:e.name,description:e.description||"",isPublic:e.isPublic,defaultUniverse:e.defaultUniverse||"",criteria:e.criteria},e.criteria&&(this.criteriaQuery=this.convertCriteriaToQuery(e.criteria)))}),this.screenerState.loading$.pipe(O(this.destroy$)).subscribe(e=>this.loading=e),this.screenerState.error$.pipe(O(this.destroy$)).subscribe(e=>this.error=e)}loadScreener(){let e=this.route.snapshot.paramMap.get("id"),i=this.route.snapshot.url.some(t=>t.path==="edit");this.isEdit=i,e&&i&&this.screenerState.loadScreener(+e).subscribe({error:t=>{this.messageService.add({severity:"error",summary:"Error",detail:"Failed to load screener for editing"}),this.router.navigate(["/screeners"])}})}saveScreener(){if(!this.screenerForm.name.trim()){this.messageService.add({severity:"warn",summary:"Validation Error",detail:"Screener name is required"});return}this.isEdit&&this.screener?this.updateScreener():this.createScreener()}createScreener(){this.screenerState.createScreener(this.screenerForm).subscribe({next:()=>{this.messageService.add({severity:"success",summary:"Success",detail:"Screener created successfully"}),this.router.navigate(["/screeners"])},error:e=>{this.messageService.add({severity:"error",summary:"Error",detail:"Failed to create screener"})}})}updateScreener(){this.screener&&this.screenerState.updateScreener(this.screener.screenerId,this.screenerForm).subscribe({next:()=>{this.messageService.add({severity:"success",summary:"Success",detail:"Screener updated successfully"}),this.router.navigate(["/screeners",this.screener.screenerId])},error:e=>{this.messageService.add({severity:"error",summary:"Error",detail:"Failed to update screener"})}})}cancel(){this.isEdit&&this.screener?this.router.navigate(["/screeners",this.screener.screenerId]):this.router.navigate(["/screeners"])}onCriteriaChange(e){this.criteriaQuery=e,this.screenerForm.criteria=this.convertQueryToCriteria(e)}onTabChange(e){this.activeTab=e.value}getIndicatorFields(){return ce.map(e=>({name:e.name,value:e.value,type:e.type,category:e.category,description:e.description,operators:this.getOperatorsForType(e.type),options:void 0}))}getOperatorsForType(e){switch(e){case"number":return["=","!=",">",">=","<","<=","between","not between","is empty","is not empty"];case"string":return["=","!=","contains","not contains","starts with","ends with","is empty","is not empty"];case"date":case"time":return["=","!=",">",">=","<","<=","between","not between","is empty","is not empty"];case"boolean":return["=","!=","is empty","is not empty"];case"category":return["=","!=","in","not in","is empty","is not empty"];default:return["=","!=","is empty","is not empty"]}}convertQueryToCriteria(e){return{condition:e.condition,rules:e.rules.map(i=>"field"in i?{field:i.field,operator:i.operator,value:i.value,entity:i.entity}:this.convertQueryToCriteria(i)),collapsed:e.collapsed}}convertCriteriaToQuery(e){return{condition:e.condition,rules:e.rules.map(i=>"field"in i?{field:i.field,operator:i.operator,value:i.value,entity:i.entity}:this.convertCriteriaToQuery(i)),collapsed:e.collapsed}}clearCriteria(){this.criteriaQuery={condition:"and",rules:[]},this.screenerForm.criteria=void 0}hasCriteria(){return this.criteriaQuery.rules.length>0}};p.\u0275fac=function(i){return new(i||p)(M(B),M(W),M(me),M(y))},p.\u0275cmp=F({type:p,selectors:[["app-screener-form"]],features:[V([y])],decls:54,vars:17,consts:[["form","ngForm"],[1,"screener-form-container"],[1,"form-header"],["pButton","","icon","pi pi-arrow-left",1,"p-button-text","back-button",3,"click"],[1,"form-content"],[3,"valueChange","value"],["value","basic"],[1,"pi","pi-info-circle"],["value","criteria"],[1,"pi","pi-filter"],["class","criteria-badge",4,"ngIf"],[3,"ngSubmit"],[1,"form-grid"],[1,"form-group"],["for","name"],["type","text","id","name","pInputText","","name","name","placeholder","Enter screener name","required","",1,"w-full",3,"ngModelChange","ngModel"],["for","description"],["id","description","name","description","placeholder","Enter screener description","rows","3",1,"w-full",3,"ngModelChange","ngModel"],["for","defaultUniverse"],["type","text","id","defaultUniverse","pInputText","","name","defaultUniverse","placeholder","Enter default universe (e.g., NSE, BSE)",1,"w-full",3,"ngModelChange","ngModel"],[1,"form-group","checkbox-group"],["name","isPublic","label","Make this screener public",3,"ngModelChange","ngModel","binary"],[1,"help-text"],[1,"form-actions"],["pButton","","type","button","label","Cancel","icon","pi pi-times",1,"p-button-outlined",3,"click"],["pButton","","type","submit","icon","pi pi-check",3,"label","disabled","loading"],[1,"criteria-header"],[1,"criteria-description"],[1,"query-builder-container"],[3,"queryChange","query","config"],[1,"criteria-actions"],["pButton","","label","Clear All Criteria","icon","pi pi-trash",1,"p-button-outlined","p-button-danger",3,"click","disabled"],["pButton","","label","Save Screener","icon","pi pi-check",3,"click","disabled","loading"],["class","criteria-preview",4,"ngIf"],[1,"criteria-badge"],[1,"criteria-preview"],[1,"criteria-summary"],[1,"status-badge","status-active"]],template:function(i,t){if(i&1){let c=T();r(0,"div",1)(1,"div",2)(2,"button",3),f("click",function(){return m(c),l(t.cancel())}),n(),r(3,"h1"),a(4),n()(),r(5,"div",4)(6,"p-tabs",5),h("valueChange",function(o){return m(c),_(t.activeTab,o)||(t.activeTab=o),l(o)}),f("valueChange",function(o){return m(c),l(t.onTabChange(o))}),r(7,"p-tablist")(8,"p-tab",6),b(9,"i",7),a(10," Basic Info "),n(),r(11,"p-tab",8),b(12,"i",9),a(13," Screening Criteria "),v(14,le,2,1,"span",10),n()(),r(15,"p-tabpanels")(16,"p-tabpanel",6)(17,"p-card")(18,"form",11,0),f("ngSubmit",function(){return m(c),l(t.saveScreener())}),r(20,"div",12)(21,"div",13)(22,"label",14),a(23,"Name *"),n(),r(24,"input",15),h("ngModelChange",function(o){return m(c),_(t.screenerForm.name,o)||(t.screenerForm.name=o),l(o)}),n()(),r(25,"div",13)(26,"label",16),a(27,"Description"),n(),r(28,"textarea",17),h("ngModelChange",function(o){return m(c),_(t.screenerForm.description,o)||(t.screenerForm.description=o),l(o)}),n()(),r(29,"div",13)(30,"label",18),a(31,"Default Universe"),n(),r(32,"input",19),h("ngModelChange",function(o){return m(c),_(t.screenerForm.defaultUniverse,o)||(t.screenerForm.defaultUniverse=o),l(o)}),n()(),r(33,"div",20)(34,"p-checkbox",21),h("ngModelChange",function(o){return m(c),_(t.screenerForm.isPublic,o)||(t.screenerForm.isPublic=o),l(o)}),n(),r(35,"small",22),a(36,"Public screeners can be viewed and used by other users"),n()()(),r(37,"div",23)(38,"button",24),f("click",function(){return m(c),l(t.cancel())}),n(),b(39,"button",25),n()()()(),r(40,"p-tabpanel",8)(41,"p-card")(42,"div",26)(43,"h3"),a(44,"Screening Criteria"),n(),r(45,"p",27),a(46," Define the technical indicators and conditions that stocks must meet to be included in this screener. You can combine multiple conditions using AND/OR logic. "),n()(),r(47,"div",28)(48,"app-query-builder",29),f("queryChange",function(o){return m(c),l(t.onCriteriaChange(o))}),n()(),r(49,"div",30)(50,"button",31),f("click",function(){return m(c),l(t.clearCriteria())}),n(),r(51,"button",32),f("click",function(){return m(c),l(t.saveScreener())}),n()(),v(52,de,17,2,"div",33),n()()()()(),b(53,"p-toast"),n()}if(i&2){let c=k(19);s(4),w(t.isEdit?"Edit Screener":"Create Screener"),s(2),C("value",t.activeTab),s(8),u("ngIf",t.hasCriteria()),s(10),C("ngModel",t.screenerForm.name),s(4),C("ngModel",t.screenerForm.description),s(4),C("ngModel",t.screenerForm.defaultUniverse),s(2),C("ngModel",t.screenerForm.isPublic),u("binary",!0),s(5),u("label",t.isEdit?"Update Screener":"Create Screener")("disabled",!c.valid||t.loading)("loading",t.loading),s(9),u("query",t.criteriaQuery)("config",t.criteriaConfig),s(2),u("disabled",!t.hasCriteria()),s(),u("disabled",t.loading)("loading",t.loading),s(),u("ngIf",t.hasCriteria())}},dependencies:[Q,I,H,G,N,j,L,Y,R,A,U,z,K,J,ee,$,Z,X,D,q,ae,oe,ie,re,te,ne,se],styles:[".screener-form-container[_ngcontent-%COMP%]{padding:2rem;max-width:800px;margin:0 auto;height:100%;display:flex;flex-direction:column}.screener-form-container[_ngcontent-%COMP%]   .form-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;margin-bottom:2rem}.screener-form-container[_ngcontent-%COMP%]   .form-header[_ngcontent-%COMP%]   .back-button[_ngcontent-%COMP%]{margin-top:.5rem}.screener-form-container[_ngcontent-%COMP%]   .form-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;color:#2c3e50;font-size:2rem;font-weight:300}.screener-form-container[_ngcontent-%COMP%]   .form-content[_ngcontent-%COMP%]{flex:1}.screener-form-container[_ngcontent-%COMP%]   .form-content[_ngcontent-%COMP%]   .form-grid[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.screener-form-container[_ngcontent-%COMP%]   .form-content[_ngcontent-%COMP%]   .form-grid[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.screener-form-container[_ngcontent-%COMP%]   .form-content[_ngcontent-%COMP%]   .form-grid[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;color:#2c3e50;font-size:.9rem}.screener-form-container[_ngcontent-%COMP%]   .form-content[_ngcontent-%COMP%]   .form-grid[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .screener-form-container[_ngcontent-%COMP%]   .form-content[_ngcontent-%COMP%]   .form-grid[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{width:100%;padding:.75rem;border:1px solid #ddd;border-radius:4px;font-size:1rem;transition:border-color .2s}.screener-form-container[_ngcontent-%COMP%]   .form-content[_ngcontent-%COMP%]   .form-grid[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .screener-form-container[_ngcontent-%COMP%]   .form-content[_ngcontent-%COMP%]   .form-grid[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#3498db;box-shadow:0 0 0 2px #3498db33}.screener-form-container[_ngcontent-%COMP%]   .form-content[_ngcontent-%COMP%]   .form-grid[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input.ng-invalid.ng-touched[_ngcontent-%COMP%], .screener-form-container[_ngcontent-%COMP%]   .form-content[_ngcontent-%COMP%]   .form-grid[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   textarea.ng-invalid.ng-touched[_ngcontent-%COMP%]{border-color:#e74c3c}.screener-form-container[_ngcontent-%COMP%]   .form-content[_ngcontent-%COMP%]   .form-grid[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{resize:vertical;min-height:100px}.screener-form-container[_ngcontent-%COMP%]   .form-content[_ngcontent-%COMP%]   .form-grid[_ngcontent-%COMP%]   .form-group.checkbox-group[_ngcontent-%COMP%]   .help-text[_ngcontent-%COMP%]{color:#7f8c8d;font-size:.8rem;margin-top:.25rem}.screener-form-container[_ngcontent-%COMP%]   .form-content[_ngcontent-%COMP%]   .form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:1rem;margin-top:2rem;padding-top:2rem;border-top:1px solid #f0f0f0}.screener-form-container[_ngcontent-%COMP%]   .form-content[_ngcontent-%COMP%]   .form-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:120px}.screener-form-container[_ngcontent-%COMP%]   .form-content[_ngcontent-%COMP%]   .criteria-header[_ngcontent-%COMP%]{margin-bottom:2rem}.screener-form-container[_ngcontent-%COMP%]   .form-content[_ngcontent-%COMP%]   .criteria-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .5rem;color:#2c3e50;font-size:1.5rem;font-weight:600}.screener-form-container[_ngcontent-%COMP%]   .form-content[_ngcontent-%COMP%]   .criteria-header[_ngcontent-%COMP%]   .criteria-description[_ngcontent-%COMP%]{color:#7f8c8d;font-size:.9rem;line-height:1.5;margin:0}.screener-form-container[_ngcontent-%COMP%]   .form-content[_ngcontent-%COMP%]   .query-builder-container[_ngcontent-%COMP%]{margin-bottom:2rem;padding:1.5rem;border:1px solid #e0e0e0;border-radius:8px;background-color:#fafafa}.screener-form-container[_ngcontent-%COMP%]   .form-content[_ngcontent-%COMP%]   .criteria-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem;padding-top:1.5rem;border-top:1px solid #f0f0f0}.screener-form-container[_ngcontent-%COMP%]   .form-content[_ngcontent-%COMP%]   .criteria-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:150px}.screener-form-container[_ngcontent-%COMP%]   .form-content[_ngcontent-%COMP%]   .criteria-preview[_ngcontent-%COMP%]{padding:1.5rem;background-color:#f8f9fa;border-radius:8px;border-left:4px solid #3498db}.screener-form-container[_ngcontent-%COMP%]   .form-content[_ngcontent-%COMP%]   .criteria-preview[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 1rem;color:#2c3e50;font-size:1.1rem;font-weight:600}.screener-form-container[_ngcontent-%COMP%]   .form-content[_ngcontent-%COMP%]   .criteria-preview[_ngcontent-%COMP%]   .criteria-summary[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.screener-form-container[_ngcontent-%COMP%]   .form-content[_ngcontent-%COMP%]   .criteria-preview[_ngcontent-%COMP%]   .criteria-summary[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#2c3e50;font-size:.9rem}.screener-form-container[_ngcontent-%COMP%]   .form-content[_ngcontent-%COMP%]   .criteria-preview[_ngcontent-%COMP%]   .criteria-summary[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-weight:600}.screener-form-container[_ngcontent-%COMP%]   .form-content[_ngcontent-%COMP%]   .criteria-preview[_ngcontent-%COMP%]   .criteria-summary[_ngcontent-%COMP%]   .status-badge[_ngcontent-%COMP%]{display:inline-block;padding:.25rem .5rem;border-radius:4px;font-size:.8rem;font-weight:600;text-transform:uppercase}.screener-form-container[_ngcontent-%COMP%]   .form-content[_ngcontent-%COMP%]   .criteria-preview[_ngcontent-%COMP%]   .criteria-summary[_ngcontent-%COMP%]   .status-badge.status-active[_ngcontent-%COMP%]{background-color:#d4edda;color:#155724;border:1px solid #c3e6cb}@media (max-width: 768px){.screener-form-container[_ngcontent-%COMP%]{padding:1rem}.screener-form-container[_ngcontent-%COMP%]   .form-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.5rem}.screener-form-container[_ngcontent-%COMP%]   .form-content[_ngcontent-%COMP%]   .form-actions[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.screener-form-container[_ngcontent-%COMP%]   .form-content[_ngcontent-%COMP%]   .form-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:auto}}[_nghost-%COMP%]     .p-card .p-card-body{padding:2rem}[_nghost-%COMP%]     .p-checkbox .p-checkbox-label{font-weight:500;color:#2c3e50}[_nghost-%COMP%]     .p-button.p-button-loading .p-button-icon{animation:_ngcontent-%COMP%_spin 1s linear infinite}[_nghost-%COMP%]     .p-tabs .p-tablist .p-tab .criteria-badge{background-color:#3498db;color:#fff;border-radius:50%;padding:.25rem .5rem;font-size:.7rem;font-weight:600;margin-left:.5rem;min-width:1.2rem;height:1.2rem;display:inline-flex;align-items:center;justify-content:center}[_nghost-%COMP%]     .query-builder-container .app-query-builder .query-builder{border:none;background:transparent}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"]});let g=p;return g})();export{We as ScreenerFormComponent};
