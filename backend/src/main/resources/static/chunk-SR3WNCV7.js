import{a as S}from"./chunk-PUWSDGFS.js";import{a as k}from"./chunk-NBMXCGLL.js";import{a as f}from"./chunk-6DF6NXBA.js";import{d as h}from"./chunk-AR7LHXST.js";import{Q as d,U as u,Y as m,c as p,la as g,lc as r}from"./chunk-53IN4TFO.js";import{a,b as n}from"./chunk-GAL4ENT6.js";var D={marketSummary:null,topGainers:null,topLosers:null,mostActive:null,searchResults:null,stockDetails:{},loading:!1,error:null,lastUpdated:{marketSummary:null,topGainers:null,topLosers:null,mostActive:null,searchResults:null,stockDetails:{}}},x=(()=>{let l=class l{get apiService(){return f.useMockData?this.mockApiService:this.realApiService}constructor(t,s){this.realApiService=t,this.mockApiService=s,this.endpoint="/market",this.state=g(D),this.marketSummary=r(()=>this.state().marketSummary),this.topGainers=r(()=>this.state().topGainers),this.topLosers=r(()=>this.state().topLosers),this.mostActive=r(()=>this.state().mostActive),this.searchResults=r(()=>this.state().searchResults),this.stockDetails=r(()=>this.state().stockDetails),this.loading=r(()=>this.state().loading),this.error=r(()=>this.state().error),this.lastUpdated=r(()=>this.state().lastUpdated)}updateState(t){this.state.update(s=>a(a({},s),t))}setLoading(t){this.updateState({loading:t})}setError(t){this.updateState({error:t})}updateTimestamp(t,s){t==="stockDetails"&&s?this.state.update(e=>n(a({},e),{lastUpdated:n(a({},e.lastUpdated),{stockDetails:n(a({},e.lastUpdated.stockDetails),{[s]:new Date})})})):t!=="stockDetails"&&this.state.update(e=>n(a({},e),{lastUpdated:n(a({},e.lastUpdated),{[t]:new Date})}))}getMarketSummary(t=!1){return!t&&this.marketSummary()&&this.lastUpdated().marketSummary&&new Date().getTime()-this.lastUpdated().marketSummary.getTime()<5*60*1e3?new p(e=>{e.next(this.marketSummary()),e.complete()}):(this.setLoading(!0),this.setError(null),this.apiService.get(`${this.endpoint}/summary`).pipe(d({next:s=>{this.updateState({marketSummary:s,loading:!1}),this.updateTimestamp("marketSummary")},error:s=>{this.setLoading(!1),this.setError(s.message||"Failed to load market summary")}})))}getTopGainers(t=10,s=!1){if(!s&&this.topGainers()&&this.lastUpdated().topGainers&&new Date().getTime()-this.lastUpdated().topGainers.getTime()<5*60*1e3)return new p(o=>{o.next(this.topGainers()),o.complete()});this.setLoading(!0),this.setError(null);let e=new h().set("limit",t.toString());return this.apiService.get(`${this.endpoint}/gainers`,e).pipe(d({next:i=>{this.updateState({topGainers:i,loading:!1}),this.updateTimestamp("topGainers")},error:i=>{this.setLoading(!1),this.setError(i.message||"Failed to load top gainers")}}))}getTopLosers(t=10,s=!1){if(!s&&this.topLosers()&&this.lastUpdated().topLosers&&new Date().getTime()-this.lastUpdated().topLosers.getTime()<5*60*1e3)return new p(o=>{o.next(this.topLosers()),o.complete()});this.setLoading(!0),this.setError(null);let e=new h().set("limit",t.toString());return this.apiService.get(`${this.endpoint}/losers`,e).pipe(d({next:i=>{this.updateState({topLosers:i,loading:!1}),this.updateTimestamp("topLosers")},error:i=>{this.setLoading(!1),this.setError(i.message||"Failed to load top losers")}}))}getMostActive(t=10,s=!1){if(!s&&this.mostActive()&&this.lastUpdated().mostActive&&new Date().getTime()-this.lastUpdated().mostActive.getTime()<5*60*1e3)return new p(o=>{o.next(this.mostActive()),o.complete()});this.setLoading(!0),this.setError(null);let e=new h().set("limit",t.toString());return this.apiService.get(`${this.endpoint}/active`,e).pipe(d({next:i=>{this.updateState({mostActive:i,loading:!1}),this.updateTimestamp("mostActive")},error:i=>{this.setLoading(!1),this.setError(i.message||"Failed to load most active stocks")}}))}searchStocks(t){this.setLoading(!0),this.setError(null);let s=new h().set("q",t);return this.apiService.get(`${this.endpoint}/search`,s).pipe(d({next:e=>{this.updateState({searchResults:e,loading:!1}),this.updateTimestamp("searchResults")},error:e=>{this.setLoading(!1),this.setError(e.message||"Failed to search stocks")}}))}getStockDetails(t,s=!1){return!s&&this.stockDetails()[t]&&this.lastUpdated().stockDetails[t]&&new Date().getTime()-this.lastUpdated().stockDetails[t].getTime()<5*60*1e3?new p(i=>{i.next(this.stockDetails()[t]),i.complete()}):(this.setLoading(!0),this.setError(null),this.apiService.get(`${this.endpoint}/stocks/${t}`).pipe(d({next:e=>{this.state.update(i=>n(a({},i),{stockDetails:n(a({},i.stockDetails),{[t]:e}),loading:!1})),this.updateTimestamp("stockDetails",t)},error:e=>{this.setLoading(!1),this.setError(e.message||`Failed to load details for stock ${t}`)}})))}clearCache(){this.state.set(D)}};l.\u0275fac=function(s){return new(s||l)(m(k),m(S))},l.\u0275prov=u({token:l,factory:l.\u0275fac,providedIn:"root"});let c=l;return c})();export{x as a};
