<div class="builder-toolbar">
  <!-- Left Section: Mode Toggle and Actions -->
  <div class="toolbar-section toolbar-left">
    <!-- Mode Toggle -->
    <div class="mode-toggle-group">
      <label class="mode-label">Mode:</label>
      <p-toggleButton
        [(ngModel)]="mode"
        onLabel="Advanced"
        offLabel="Simple"
        onIcon="pi pi-cog"
        offIcon="pi pi-user"
        [disabled]="!hasContent"
        (onChange)="onModeToggle()"
        styleClass="mode-toggle">
      </p-toggleButton>
    </div>
    
    <!-- Add Condition Button -->
    <p-button
      label="Add Condition"
      icon="pi pi-plus"
      size="small"
      severity="success"
      (onClick)="addCondition.emit()"
      styleClass="add-condition-btn">
    </p-button>
  </div>
  
  <!-- Right Section: File Operations and Settings -->
  <div class="toolbar-section toolbar-right">
    <!-- Import/Export Group -->
    <div class="file-operations-group">
      <p-button
        label="Import"
        icon="pi pi-upload"
        size="small"
        severity="secondary"
        (onClick)="onImport()"
        pTooltip="Import criteria from JSON file"
        tooltipPosition="bottom"
        styleClass="import-btn">
      </p-button>
      
      <p-button
        label="Export"
        icon="pi pi-download"
        size="small"
        severity="secondary"
        [disabled]="!hasContent"
        (onClick)="onExport()"
        pTooltip="Export criteria to JSON file"
        tooltipPosition="bottom"
        styleClass="export-btn">
      </p-button>
    </div>
    
    <!-- Presets Group -->
    <div class="presets-group">
      <p-button
        label="Save Preset"
        icon="pi pi-bookmark"
        size="small"
        severity="info"
        [disabled]="!hasContent"
        (onClick)="onSavePreset()"
        pTooltip="Save current criteria as preset"
        tooltipPosition="bottom"
        styleClass="save-preset-btn">
      </p-button>
      
      <p-button
        label="Presets"
        icon="pi pi-list"
        size="small"
        severity="info"
        [disabled]="presets.length === 0"
        (onClick)="showPresetMenu = !showPresetMenu"
        pTooltip="Load saved presets"
        tooltipPosition="bottom"
        styleClass="presets-btn">
      </p-button>
      
      <!-- Presets Dropdown Menu -->
      <div class="presets-menu" *ngIf="showPresetMenu && presets.length > 0">
        <div class="presets-menu-header">
          <span>Saved Presets</span>
          <p-button
            icon="pi pi-times"
            size="small"
            text="true"
            (onClick)="showPresetMenu = false">
          </p-button>
        </div>
        <div class="presets-list">
          <div
            class="preset-item"
            *ngFor="let preset of presets; let i = index"
            (click)="loadPreset(preset)">
            <div class="preset-info">
              <span class="preset-name">{{ preset.name }}</span>
              <span class="preset-date">{{ preset.createdAt | date:'short' }}</span>
            </div>
            <p-button
              icon="pi pi-trash"
              size="small"
              severity="danger"
              text="true"
              (onClick)="deletePreset(i, $event)"
              pTooltip="Delete preset">
            </p-button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Settings Group -->
    <div class="settings-group">
      <p-button
        [label]="showSqlPreview ? 'Hide SQL' : 'Show SQL'"
        [icon]="showSqlPreview ? 'pi pi-eye-slash' : 'pi pi-eye'"
        size="small"
        severity="help"
        [disabled]="!hasContent"
        (onClick)="onSqlPreviewToggle()"
        pTooltip="Toggle SQL preview panel"
        tooltipPosition="bottom"
        styleClass="sql-preview-toggle">
      </p-button>
      
      <p-button
        label="Clear All"
        icon="pi pi-trash"
        size="small"
        severity="danger"
        [disabled]="!hasContent"
        (onClick)="onClearAll()"
        pTooltip="Clear all conditions"
        tooltipPosition="bottom"
        styleClass="clear-all-btn">
      </p-button>
    </div>
  </div>
  
  <!-- Hidden File Input for Import -->
  <input
    #fileInput
    type="file"
    accept=".json"
    style="display: none"
    (change)="onFileSelected($event)">
</div>

<!-- Save Preset Dialog -->
<p-dialog
  [(visible)]="showSavePresetDialog"
  header="Save Preset"
  [modal]="true"
  [closable]="true"
  [resizable]="false"
  [draggable]="false"
  styleClass="save-preset-dialog"
  (onHide)="cancelSavePreset()">
  
  <div class="save-preset-content">
    <div class="field">
      <label for="presetName">Preset Name</label>
      <input
        id="presetName"
        type="text"
        pInputText
        [(ngModel)]="newPresetName"
        placeholder="Enter preset name"
        maxlength="50"
        class="preset-name-input"
        (keyup.enter)="savePreset()">
    </div>
    <small class="field-help">
      Give your preset a descriptive name to easily identify it later.
    </small>
  </div>
  
  <ng-template pTemplate="footer">
    <p-button
      label="Cancel"
      icon="pi pi-times"
      severity="secondary"
      (onClick)="cancelSavePreset()">
    </p-button>
    <p-button
      label="Save"
      icon="pi pi-check"
      severity="success"
      [disabled]="!newPresetName.trim()"
      (onClick)="savePreset()">
    </p-button>
  </ng-template>
</p-dialog>

<!-- Overlay for closing preset menu -->
<div
  class="preset-menu-overlay"
  *ngIf="showPresetMenu"
  (click)="showPresetMenu = false">
</div>