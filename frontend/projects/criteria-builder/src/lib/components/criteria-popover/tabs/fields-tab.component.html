<!-- Loading State -->
<div class="loading-container" *ngIf="isLoading">
  <p-progressSpinner 
    [style]="{ width: '30px', height: '30px' }" 
    strokeWidth="4">
  </p-progressSpinner>
  <span class="loading-text">Loading fields...</span>
</div>

<!-- Error State -->
<div class="error-container" *ngIf="error && !isLoading">
  <p-message 
    severity="error" 
    [text]="error"
    styleClass="error-message">
  </p-message>
  <button 
    type="button" 
    class="p-button p-button-sm p-button-outlined"
    (click)="retryLoad()">
    <i class="pi pi-refresh"></i>
    Retry
  </button>
</div>

<!-- Fields Content -->
<div class="fields-content" *ngIf="!isLoading && !error">
  
  <!-- Search Input -->
  <div class="search-container">
    <span class="p-input-icon-left">
      <i class="pi pi-search"></i>
      <input 
        type="text" 
        pInputText 
        [value]="searchTerm"
        (input)="onSearchChange($event.target?.value || '')"
        placeholder="Search fields..."
        class="search-input">
    </span>
  </div>

  <!-- No Results -->
  <div class="no-results" *ngIf="filteredFields.length === 0">
    <i class="pi pi-info-circle"></i>
    <span>No fields found</span>
    <small *ngIf="searchTerm">Try adjusting your search terms</small>
  </div>

  <!-- Fields by Category -->
  <div class="fields-container" *ngIf="filteredFields.length > 0">
    <p-accordion 
      [multiple]="true" 
      styleClass="fields-accordion">
      
      <p-accordionpanel 
        *ngFor="let category of categories; trackBy: trackByCategory">
        
        <p-accordionheader>
          <div class="category-header">
            <span class="category-title">{{ category }}</span>
            <p-badge 
              [value]="groupedFields[category].length.toString()" 
              styleClass="category-count">
            </p-badge>
          </div>
        </p-accordionheader>

        <p-accordioncontent>
          <!-- Fields List -->
          <div class="fields-list">
          <div 
            class="field-item"
            *ngFor="let field of groupedFields[category]; trackBy: trackByFieldId"
            [class.deprecated]="field.deprecated"
            (click)="onFieldSelect(field)">
            
            <!-- Field Icon -->
            <i 
              [class]="field.icon || getFieldTypeIcon(field.dataType)" 
              class="field-icon">
            </i>
            
            <!-- Field Content -->
            <div class="field-content">
              <div class="field-header">
                <span class="field-name">{{ field.name }}</span>
                <div class="field-badges">
                  <p-badge 
                    [value]="formatDataType(field.dataType)" 
                    [styleClass]="getFieldTypeBadge(field.dataType)"
                    class="type-badge">
                  </p-badge>
                  <p-badge 
                    value="DEPRECATED" 
                    styleClass="p-badge-danger"
                    class="deprecated-badge"
                    *ngIf="field.deprecated">
                  </p-badge>
                </div>
              </div>
              
              <div class="field-description" *ngIf="field.description">
                {{ field.description }}
              </div>
              
              <div class="field-meta" *ngIf="hasAdditionalInfo(field)">
                <small class="field-info">{{ getAdditionalInfo(field) }}</small>
              </div>
            </div>

            <!-- Selection Indicator -->
            <i class="pi pi-angle-right field-arrow"></i>
          </div>
          </div>
        </p-accordioncontent>
      </p-accordionpanel>
    </p-accordion>
  </div>
</div>