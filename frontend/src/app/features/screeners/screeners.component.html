<div class="screeners-container">
  <div class="header">
    <h1>Stock Screeners</h1>
    <button pButton label="Create Screener" icon="pi pi-plus" (click)="createScreener()"></button>
  </div>

  <div class="content">
    <p-card *ngIf="loading" styleClass="loading-card">
      <div class="loading-message">
        <i class="pi pi-spin pi-spinner" style="font-size: 2rem"></i>
        <p>Loading screeners...</p>
      </div>
    </p-card>

    <div *ngIf="!loading">
      <p-tabs [(value)]="activeTab">
        <p-tablist>
          @for(tab of tabs; track tab.value) {
            <p-tab [value]="tab.value" class="flex items-center !gap-2 text-inherit">
              <span>{{ tab.label }}</span>
            </p-tab>
          }
        </p-tablist>

        <p-tabpanel [value]="'all'">
          <p-table [value]="screeners" styleClass="p-datatable-sm" [tableStyle]="{'min-width': '50rem'}">
            <ng-template pTemplate="header">
              <tr>
                <th>Name</th>
                <th>Description</th>
                <th>Category</th>
                <th>Last Run</th>
                <th>Results</th>
                <th>Actions</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-screener>
              <tr>
                <td>{{ screener.name }}</td>
                <td>{{ screener.description }}</td>
                <td>{{ screener.category }}</td>
                <td>{{ screener.lastRun | date:'short' }}</td>
                <td>{{ screener.results }}</td>
                <td>
                  <div class="screener-actions">
                    <button pButton icon="pi pi-play" class="p-button-rounded p-button-sm p-button-success" (click)="runScreener(screener)" title="Run Screener"></button>
                    <button pButton icon="pi pi-eye" class="p-button-rounded p-button-sm p-button-info" (click)="viewResults(screener)" title="View Results"></button>
                    <button pButton icon="pi pi-pencil" class="p-button-rounded p-button-sm p-button-warning" (click)="editScreener(screener)" title="Edit Screener"></button>
                    <button pButton icon="pi pi-trash" class="p-button-rounded p-button-sm p-button-danger" (click)="deleteScreener(screener)" title="Delete Screener"></button>
                  </div>
                </td>
              </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
              <tr>
                <td colspan="6">
                  <div class="empty-message">
                    <p>No screeners available.</p>
                  </div>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </p-tabpanel>

        <p-tabpanel [value]="'predefined'">
          <p-table [value]="predefinedScreeners" styleClass="p-datatable-sm" [tableStyle]="{'min-width': '50rem'}">
            <ng-template pTemplate="header">
              <tr>
                <th>Name</th>
                <th>Description</th>
                <th>Category</th>
                <th>Last Run</th>
                <th>Results</th>
                <th>Actions</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-screener>
              <tr>
                <td>{{ screener.name }}</td>
                <td>{{ screener.description }}</td>
                <td>{{ screener.category }}</td>
                <td>{{ screener.lastRun | date:'short' }}</td>
                <td>{{ screener.results }}</td>
                <td>
                  <div class="screener-actions">
                    <button pButton icon="pi pi-play" class="p-button-rounded p-button-sm p-button-success" (click)="runScreener(screener)" title="Run Screener"></button>
                    <button pButton icon="pi pi-eye" class="p-button-rounded p-button-sm p-button-info" (click)="viewResults(screener)" title="View Results"></button>
                  </div>
                </td>
              </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
              <tr>
                <td colspan="6">
                  <div class="empty-message">
                    <p>No predefined screeners available.</p>
                  </div>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </p-tabpanel>

        <p-tabpanel [value]="'custom'">
          <p-table [value]="customScreeners" styleClass="p-datatable-sm" [tableStyle]="{'min-width': '50rem'}">
            <ng-template pTemplate="header">
              <tr>
                <th>Name</th>
                <th>Description</th>
                <th>Category</th>
                <th>Last Run</th>
                <th>Results</th>
                <th>Actions</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-screener>
              <tr>
                <td>{{ screener.name }}</td>
                <td>{{ screener.description }}</td>
                <td>{{ screener.category }}</td>
                <td>{{ screener.lastRun | date:'short' }}</td>
                <td>{{ screener.results }}</td>
                <td>
                  <div class="screener-actions">
                    <button pButton icon="pi pi-play" class="p-button-rounded p-button-sm p-button-success" (click)="runScreener(screener)" title="Run Screener"></button>
                    <button pButton icon="pi pi-eye" class="p-button-rounded p-button-sm p-button-info" (click)="viewResults(screener)" title="View Results"></button>
                    <button pButton icon="pi pi-pencil" class="p-button-rounded p-button-sm p-button-warning" (click)="editScreener(screener)" title="Edit Screener"></button>
                    <button pButton icon="pi pi-trash" class="p-button-rounded p-button-sm p-button-danger" (click)="deleteScreener(screener)" title="Delete Screener"></button>
                  </div>
                </td>
              </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
              <tr>
                <td colspan="6">
                  <div class="empty-message">
                    <p>No custom screeners available.</p>
                  </div>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </p-tabpanel>
      </p-tabs>
    </div>
  </div>
</div>
