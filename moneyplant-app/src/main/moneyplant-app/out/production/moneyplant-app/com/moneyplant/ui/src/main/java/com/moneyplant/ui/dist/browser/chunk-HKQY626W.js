import{c as E,d as W}from"./chunk-BCYXNNE7.js";import{J as U,O as c,S as $,W as D,c as k,ia as I,l as w,m as o,mc as m,p as u,r as F,w as P,z as d}from"./chunk-E5FNFP2Z.js";import{a as l,b as f}from"./chunk-JKOY2XUY.js";var S={production:!1,apiUrl:"http://localhost:3000/api",useMockData:!0};var T=(()=>{let a=class a{constructor(t){this.http=t,this.apiUrl=S.apiUrl}get(t,e=new E){return this.http.get(`${this.apiUrl}${t}`,{params:e}).pipe(U(i=>i.pipe(F((s,r)=>{let n=r+1;return n>3?o(()=>s):(console.log(`GET Attempt ${n}: retrying in ${n*1e3}ms`),P(n*1e3))}))),d(this.handleError))}post(t,e){return this.http.post(`${this.apiUrl}${t}`,e).pipe(U(i=>i.pipe(F((s,r)=>{let n=r+1;return n>3?o(()=>s):(console.log(`POST Attempt ${n}: retrying in ${n*1e3}ms`),P(n*1e3))}))),d(this.handleError))}put(t,e){return this.http.put(`${this.apiUrl}${t}`,e).pipe(U(i=>i.pipe(F((s,r)=>{let n=r+1;return n>3?o(()=>s):(console.log(`PUT Attempt ${n}: retrying in ${n*1e3}ms`),P(n*1e3))}))),d(this.handleError))}delete(t){return this.http.delete(`${this.apiUrl}${t}`).pipe(U(e=>e.pipe(F((i,s)=>{let r=s+1;return r>3?o(()=>i):(console.log(`Attempt ${r}: retrying in ${r*1e3}ms`),P(r*1e3))}))),d(this.handleError))}handleError(t){return console.error("API error",t),o(()=>t)}};a.\u0275fac=function(e){return new(e||a)(D(W))},a.\u0275prov=$({token:a,factory:a.\u0275fac,providedIn:"root"});let p=a;return p})();var v=(()=>{let a=class a{constructor(t){this.http=t,this.watchlistsData=null,this.holdingsData=null,this.positionsData=null,this.marketData=null,this.notificationsData=null,this.featureFlagsData=null}loadWatchlistsData(){return this.watchlistsData?w(this.watchlistsData):this.http.get("assets/mock-data/watchlists.json").pipe(c(t=>this.watchlistsData=t),d(t=>(console.error("Error loading watchlists mock data",t),o(()=>t))))}loadHoldingsData(){return this.holdingsData?w(this.holdingsData):this.http.get("assets/mock-data/holdings.json").pipe(c(t=>this.holdingsData=t),d(t=>(console.error("Error loading holdings mock data",t),o(()=>t))))}loadPositionsData(){return this.positionsData?w(this.positionsData):this.http.get("assets/mock-data/positions.json").pipe(c(t=>this.positionsData=t),d(t=>(console.error("Error loading positions mock data",t),o(()=>t))))}loadMarketData(){return this.marketData?w(this.marketData):this.http.get("assets/mock-data/market.json").pipe(c(t=>this.marketData=t),d(t=>(console.error("Error loading market mock data",t),o(()=>t))))}loadNotificationsData(){return this.notificationsData?w(this.notificationsData):this.http.get("assets/mock-data/notifications.json").pipe(c(t=>this.notificationsData=t),d(t=>(console.error("Error loading notifications mock data",t),o(()=>t))))}loadFeatureFlagsData(){return this.featureFlagsData?w(this.featureFlagsData):this.http.get("assets/mock-data/feature-flags.json").pipe(c(t=>this.featureFlagsData=t),d(t=>(console.error("Error loading feature flags mock data",t),o(()=>t))))}get(t,e){return t.startsWith("/watchlists")?this.handleWatchlistsRequest(t):t.startsWith("/holdings")?this.handleHoldingsRequest(t):t.startsWith("/positions")?this.handlePositionsRequest(t):t.startsWith("/market")?this.handleMarketRequest(t,e):t.startsWith("/notifications")?this.handleNotificationsRequest(t):t.startsWith("/feature-flags")?this.handleFeatureFlagsRequest(t):o(()=>new Error(`Mock API path not supported: ${t}`))}post(t,e){return t.startsWith("/watchlists")?this.handleWatchlistsPost(t,e):t.startsWith("/holdings")?this.handleHoldingsPost(t,e):t.startsWith("/positions")?this.handlePositionsPost(t,e):t.startsWith("/notifications")?this.handleNotificationsPost(t,e):t.startsWith("/feature-flags")?this.handleFeatureFlagsPost(t,e):o(()=>new Error(`Mock API path not supported: ${t}`))}put(t,e){return t.startsWith("/watchlists")?this.handleWatchlistsPut(t,e):t.startsWith("/holdings")?this.handleHoldingsPut(t,e):t.startsWith("/positions")?this.handlePositionsPut(t,e):t.startsWith("/notifications")?this.handleNotificationsPut(t,e):t.startsWith("/feature-flags")?this.handleFeatureFlagsPut(t,e):o(()=>new Error(`Mock API path not supported: ${t}`))}delete(t){return t.startsWith("/watchlists")?this.handleWatchlistsDelete(t):t.startsWith("/holdings")?this.handleHoldingsDelete(t):t.startsWith("/positions")?this.handlePositionsDelete(t):t.startsWith("/notifications")?this.handleNotificationsDelete(t):t.startsWith("/feature-flags")?this.handleFeatureFlagsDelete(t):o(()=>new Error(`Mock API path not supported: ${t}`))}handleWatchlistsRequest(t){return this.loadWatchlistsData().pipe(u(e=>{if(t==="/watchlists")return e;let i=t.split("/");if(i.length===3){let s=i[2],r=e.find(n=>n.id===s);if(r)return r;throw new Error(`Watchlist with ID ${s} not found`)}throw new Error(`Unsupported watchlists path: ${t}`)}))}handleWatchlistsPost(t,e){return this.loadWatchlistsData().pipe(u(i=>{if(t==="/watchlists"){let r=f(l({},e),{id:(Math.max(...i.map(n=>parseInt(n.id,10)))+1).toString(),items:e.items||[]});return this.watchlistsData.push(r),r}let s=t.split("/");if(s.length===4&&s[3]==="symbols"){let r=s[2],n=i.find(g=>g.id===r);if(!n)throw new Error(`Watchlist with ID ${r} not found`);let h={symbol:e.symbol,name:`${e.symbol} Company`,price:Math.random()*1e3,change:Math.random()*.1-.05};return n.items.push(h),n}throw new Error(`Unsupported watchlists POST path: ${t}`)}))}handleWatchlistsPut(t,e){return this.loadWatchlistsData().pipe(u(i=>{let s=t.split("/");if(s.length===3){let r=s[2],n=i.findIndex(g=>g.id===r);if(n===-1)throw new Error(`Watchlist with ID ${r} not found`);let h=l(l({},i[n]),e);return this.watchlistsData[n]=h,h}throw new Error(`Unsupported watchlists PUT path: ${t}`)}))}handleWatchlistsDelete(t){return this.loadWatchlistsData().pipe(u(e=>{let i=t.split("/");if(i.length===3){let s=i[2],r=e.findIndex(n=>n.id===s);if(r===-1)throw new Error(`Watchlist with ID ${s} not found`);return this.watchlistsData.splice(r,1),{}}if(i.length===5&&i[3]==="symbols"){let s=i[2],r=i[4],n=e.find(g=>g.id===s);if(!n)throw new Error(`Watchlist with ID ${s} not found`);let h=n.items.findIndex(g=>g.symbol===r);if(h===-1)throw new Error(`Symbol ${r} not found in watchlist ${s}`);return n.items.splice(h,1),n}throw new Error(`Unsupported watchlists DELETE path: ${t}`)}))}handleHoldingsRequest(t){return this.loadHoldingsData().pipe(u(e=>{if(t==="/holdings")return e;let i=t.split("/");if(i.length===3){let s=i[2],r=e.find(n=>n.id===s);if(r)return r;throw new Error(`Holding group with ID ${s} not found`)}throw new Error(`Unsupported holdings path: ${t}`)}))}handleHoldingsPost(t,e){return o(()=>new Error("Holdings POST not implemented"))}handleHoldingsPut(t,e){return o(()=>new Error("Holdings PUT not implemented"))}handleHoldingsDelete(t){return o(()=>new Error("Holdings DELETE not implemented"))}handlePositionsRequest(t){return this.loadPositionsData().pipe(u(e=>{if(t==="/positions")return e;if(t==="/positions/summary")return e.summary;let i=t.split("/");if(i.length===3){let s=i[2],r=e.positions.find(n=>n.id===s);if(r)return r;throw new Error(`Position with ID ${s} not found`)}throw new Error(`Unsupported positions path: ${t}`)}))}handlePositionsPost(t,e){return o(()=>new Error("Positions POST not implemented"))}handlePositionsPut(t,e){return o(()=>new Error("Positions PUT not implemented"))}handlePositionsDelete(t){return o(()=>new Error("Positions DELETE not implemented"))}handleMarketRequest(t,e){return this.loadMarketData().pipe(u(i=>{if(t==="/market/summary")return i.summary;if(t==="/market/gainers")return i.gainers;if(t==="/market/losers")return i.losers;if(t==="/market/active")return i.active;if(t.startsWith("/market/search"))return Object.values(i.stocks);if(t.startsWith("/market/stocks/")){let s=t.split("/");if(s.length===4){let r=s[3],n=i.stocks[r];if(n)return n;throw new Error(`Stock with symbol ${r} not found`)}}throw new Error(`Unsupported market path: ${t}`)}))}handleNotificationsRequest(t){return this.loadNotificationsData().pipe(u(e=>{if(t==="/notifications")return e;let i=t.split("/");if(i.length===3){let s=i[2],r=e.find(n=>n.id===s);if(r)return r;throw new Error(`Notification with ID ${s} not found`)}throw new Error(`Unsupported notifications path: ${t}`)}))}handleNotificationsPost(t,e){return o(()=>new Error("Notifications POST not implemented"))}handleNotificationsPut(t,e){return this.loadNotificationsData().pipe(u(i=>{let s=t.split("/");if(s.length===4&&s[3]==="read"){let r=s[2],n=i.find(h=>h.id===r);if(!n)throw new Error(`Notification with ID ${r} not found`);return n.isRead=!0,n}if(t==="/notifications/read-all")return i.forEach(r=>{r.isRead=!0}),{};throw new Error(`Unsupported notifications PUT path: ${t}`)}))}handleNotificationsDelete(t){return this.loadNotificationsData().pipe(u(e=>{let i=t.split("/");if(i.length===3){let s=i[2],r=e.findIndex(n=>n.id===s);if(r===-1)throw new Error(`Notification with ID ${s} not found`);return this.notificationsData.splice(r,1),{}}if(t==="/notifications/read")return this.notificationsData=e.filter(s=>!s.isRead),{};throw new Error(`Unsupported notifications DELETE path: ${t}`)}))}handleFeatureFlagsRequest(t){return this.loadFeatureFlagsData().pipe(u(e=>{if(t==="/feature-flags")return e;let i=t.split("/");if(i.length===3){let s=i[2],r=e.find(n=>n.id===s);if(r)return r;throw new Error(`Feature flag with ID ${s} not found`)}throw new Error(`Unsupported feature flags path: ${t}`)}))}handleFeatureFlagsPost(t,e){return this.loadFeatureFlagsData().pipe(u(i=>{if(t==="/feature-flags"){let s=f(l({},e),{id:`feature-${i.length+1}`});return this.featureFlagsData.push(s),s}throw new Error(`Unsupported feature flags POST path: ${t}`)}))}handleFeatureFlagsPut(t,e){return this.loadFeatureFlagsData().pipe(u(i=>{let s=t.split("/");if(s.length===3){let r=s[2],n=i.findIndex(g=>g.id===r);if(n===-1)throw new Error(`Feature flag with ID ${r} not found`);let h=l(l({},i[n]),e);return this.featureFlagsData[n]=h,h}if(s.length===4&&s[3]==="enable"){let r=s[2],n=i.find(h=>h.id===r);if(!n)throw new Error(`Feature flag with ID ${r} not found`);return n.enabled=!0,n}if(s.length===4&&s[3]==="disable"){let r=s[2],n=i.find(h=>h.id===r);if(!n)throw new Error(`Feature flag with ID ${r} not found`);return n.enabled=!1,n}throw new Error(`Unsupported feature flags PUT path: ${t}`)}))}handleFeatureFlagsDelete(t){return this.loadFeatureFlagsData().pipe(u(e=>{let i=t.split("/");if(i.length===3){let s=i[2],r=e.findIndex(n=>n.id===s);if(r===-1)throw new Error(`Feature flag with ID ${s} not found`);return this.featureFlagsData.splice(r,1),{}}throw new Error(`Unsupported feature flags DELETE path: ${t}`)}))}};a.\u0275fac=function(e){return new(e||a)(D(W))},a.\u0275prov=$({token:a,factory:a.\u0275fac,providedIn:"root"});let p=a;return p})();var x={marketSummary:null,topGainers:null,topLosers:null,mostActive:null,searchResults:null,stockDetails:{},loading:!1,error:null,lastUpdated:{marketSummary:null,topGainers:null,topLosers:null,mostActive:null,searchResults:null,stockDetails:{}}},Q=(()=>{let a=class a{get apiService(){return S.useMockData?this.mockApiService:this.realApiService}constructor(t,e){this.realApiService=t,this.mockApiService=e,this.endpoint="/market",this.state=I(x),this.marketSummary=m(()=>this.state().marketSummary),this.topGainers=m(()=>this.state().topGainers),this.topLosers=m(()=>this.state().topLosers),this.mostActive=m(()=>this.state().mostActive),this.searchResults=m(()=>this.state().searchResults),this.stockDetails=m(()=>this.state().stockDetails),this.loading=m(()=>this.state().loading),this.error=m(()=>this.state().error),this.lastUpdated=m(()=>this.state().lastUpdated)}updateState(t){this.state.update(e=>l(l({},e),t))}setLoading(t){this.updateState({loading:t})}setError(t){this.updateState({error:t})}updateTimestamp(t,e){t==="stockDetails"&&e?this.state.update(i=>f(l({},i),{lastUpdated:f(l({},i.lastUpdated),{stockDetails:f(l({},i.lastUpdated.stockDetails),{[e]:new Date})})})):t!=="stockDetails"&&this.state.update(i=>f(l({},i),{lastUpdated:f(l({},i.lastUpdated),{[t]:new Date})}))}getMarketSummary(t=!1){return!t&&this.marketSummary()&&this.lastUpdated().marketSummary&&new Date().getTime()-this.lastUpdated().marketSummary.getTime()<5*60*1e3?new k(i=>{i.next(this.marketSummary()),i.complete()}):(this.setLoading(!0),this.setError(null),this.apiService.get(`${this.endpoint}/summary`).pipe(c({next:e=>{this.updateState({marketSummary:e,loading:!1}),this.updateTimestamp("marketSummary")},error:e=>{this.setLoading(!1),this.setError(e.message||"Failed to load market summary")}})))}getTopGainers(t=10,e=!1){if(!e&&this.topGainers()&&this.lastUpdated().topGainers&&new Date().getTime()-this.lastUpdated().topGainers.getTime()<5*60*1e3)return new k(r=>{r.next(this.topGainers()),r.complete()});this.setLoading(!0),this.setError(null);let i=new E().set("limit",t.toString());return this.apiService.get(`${this.endpoint}/gainers`,i).pipe(c({next:s=>{this.updateState({topGainers:s,loading:!1}),this.updateTimestamp("topGainers")},error:s=>{this.setLoading(!1),this.setError(s.message||"Failed to load top gainers")}}))}getTopLosers(t=10,e=!1){if(!e&&this.topLosers()&&this.lastUpdated().topLosers&&new Date().getTime()-this.lastUpdated().topLosers.getTime()<5*60*1e3)return new k(r=>{r.next(this.topLosers()),r.complete()});this.setLoading(!0),this.setError(null);let i=new E().set("limit",t.toString());return this.apiService.get(`${this.endpoint}/losers`,i).pipe(c({next:s=>{this.updateState({topLosers:s,loading:!1}),this.updateTimestamp("topLosers")},error:s=>{this.setLoading(!1),this.setError(s.message||"Failed to load top losers")}}))}getMostActive(t=10,e=!1){if(!e&&this.mostActive()&&this.lastUpdated().mostActive&&new Date().getTime()-this.lastUpdated().mostActive.getTime()<5*60*1e3)return new k(r=>{r.next(this.mostActive()),r.complete()});this.setLoading(!0),this.setError(null);let i=new E().set("limit",t.toString());return this.apiService.get(`${this.endpoint}/active`,i).pipe(c({next:s=>{this.updateState({mostActive:s,loading:!1}),this.updateTimestamp("mostActive")},error:s=>{this.setLoading(!1),this.setError(s.message||"Failed to load most active stocks")}}))}searchStocks(t){this.setLoading(!0),this.setError(null);let e=new E().set("q",t);return this.apiService.get(`${this.endpoint}/search`,e).pipe(c({next:i=>{this.updateState({searchResults:i,loading:!1}),this.updateTimestamp("searchResults")},error:i=>{this.setLoading(!1),this.setError(i.message||"Failed to search stocks")}}))}getStockDetails(t,e=!1){return!e&&this.stockDetails()[t]&&this.lastUpdated().stockDetails[t]&&new Date().getTime()-this.lastUpdated().stockDetails[t].getTime()<5*60*1e3?new k(s=>{s.next(this.stockDetails()[t]),s.complete()}):(this.setLoading(!0),this.setError(null),this.apiService.get(`${this.endpoint}/stocks/${t}`).pipe(c({next:i=>{this.state.update(s=>f(l({},s),{stockDetails:f(l({},s.stockDetails),{[t]:i}),loading:!1})),this.updateTimestamp("stockDetails",t)},error:i=>{this.setLoading(!1),this.setError(i.message||`Failed to load details for stock ${t}`)}})))}clearCache(){this.state.set(x)}};a.\u0275fac=function(e){return new(e||a)(D(T),D(v))},a.\u0275prov=$({token:a,factory:a.\u0275fac,providedIn:"root"});let p=a;return p})();export{S as a,T as b,v as c,Q as d};
