# Implementation Plan - Screener Form Criteria Builder Integration

- [x] 1. Remove query-builder dependencies and import criteria-builder library
  - Remove QueryBuilderComponent import from screener-form.component.ts
  - Add AcCriteriaBuilderComponent import from @projects/criteria-builder
  - Update component imports array to use criteria-builder instead of query-builder
  - Remove any unused query-builder related imports and references
  - Verify application compiles without query-builder dependencies
  - _Requirements: 1.1, 1.2, 1.3, 1.4_

- [x] 2. Set up static field configuration for MVP
  - [x] 2.1 Create static field mapping from INDICATOR_FIELDS
    - Add method to convert INDICATOR_FIELDS to FieldMeta format
    - Map field types using FIELD_TYPE_MAPPING constants
    - Set up basic operator configuration for different field types
    - Initialize staticFields property in component
    - _Requirements: 4.1, 4.2, 4.3_
  - [x] 2.2 Configure basic criteria builder settings
    - Set up criteriaConfig with MVP settings (no advanced functions, no SQL preview)
    - Configure allowGrouping: true and maxDepth: 3 for basic grouping
    - Set compactMode: false for better visibility
    - _Requirements: 4.4, 4.5_

- [x] 3. Implement basic data conversion methods
  - [x] 3.1 Add CriteriaDSL to ScreenerCriteria conversion
    - Implement convertDslToScreenerCriteria method in component
    - Add convertDslGroup method for recursive group conversion
    - Add convertDslCondition method for individual condition conversion
    - Handle basic operator mapping between formats
    - _Requirements: 2.1, 2.2, 2.3_
  - [x] 3.2 Add ScreenerCriteria to CriteriaDSL conversion
    - Implement convertScreenerCriteriaToDsl method in component
    - Add convertScreenerGroup method for recursive group conversion
    - Add convertScreenerRule method for individual rule conversion
    - Add createEmptyDSL method for null/empty cases
    - _Requirements: 2.1, 2.2, 2.5_
  - [x] 3.3 Add basic value type inference
    - Implement inferValueType method for automatic type detection
    - Support number, string, boolean, and date type inference
    - Handle edge cases and default to string type
    - _Requirements: 2.3_

- [x] 4. Update component template to use criteria-builder
  - [x] 4.1 Replace query-builder component with criteria-builder
    - Update criteria tab template to use mp-criteria-builder component
    - Set up component inputs: [value], [config], [fields]
    - Set up component outputs: (valueChange)
    - Remove old query-builder template code
    - _Requirements: 1.2, 1.5_
  - [x] 4.2 Update criteria preview section
    - Modify criteria preview to work with CriteriaDSL structure
    - Update getCriteriaCount method to count conditions in DSL format
    - Simplify preview to show basic information (count, logic, status)
    - Remove complex preview features for MVP
    - _Requirements: 6.2, 6.4_

- [x] 5. Integrate criteria builder with form state management
  - [x] 5.1 Update onCriteriaChange method
    - Modify method to accept CriteriaDSL instead of QueryRuleSet
    - Add conversion from CriteriaDSL to ScreenerCriteria format
    - Update screenerForm.criteria with converted data
    - Handle null/empty criteria cases gracefully
    - _Requirements: 3.1, 3.2, 3.3_
  - [x] 5.2 Update form initialization for existing screeners
    - Modify initializeSubscriptions to handle criteria conversion on load
    - Add conversion from existing ScreenerCriteria to CriteriaDSL
    - Set criteriaDSL property for criteria builder initialization
    - Handle cases where existing screener has no criteria
    - _Requirements: 2.1, 2.2, 2.5_
  - [x] 5.3 Update hasCriteria and clearCriteria methods
    - Modify hasCriteria to work with CriteriaDSL structure
    - Update clearCriteria to reset both criteriaDSL and screenerForm.criteria
    - Ensure proper state synchronization between formats
    - _Requirements: 3.4, 3.5_

- [x] 6. Add basic error handling and user feedback
  - [x] 6.1 Implement basic error handling methods
    - Add handleCriteriaError method for general criteria errors
    - Add handleConversionError method for data conversion issues
    - Add getBasicErrorMessage method for user-friendly error messages
    - Use existing messageService for error display
    - _Requirements: 5.1, 5.2, 5.3, 5.4_
  - [x] 6.2 Add error handling to conversion methods
    - Wrap conversion methods in try-catch blocks
    - Log errors to console for debugging
    - Show user-friendly error messages via toast notifications
    - Provide fallback behavior (empty criteria) when conversion fails
    - _Requirements: 5.2, 5.4_

- [x] 7. Update component styling and visual integration
  - [x] 7.1 Ensure criteria builder fits within existing layout
    - Verify criteria-builder component renders properly within tab panel
    - Ensure consistent spacing and padding with existing form elements
    - Test responsive behavior on different screen sizes
    - _Requirements: 6.1, 6.3_
  - [x] 7.2 Update criteria tab badge to show count
    - Modify template to show criteria count badge when criteria exist
    - Use getCriteriaCount method to display number of conditions
    - Style badge consistently with existing UI patterns
    - _Requirements: 6.2_

- [x] 8. Test basic integration functionality
  - [x] 8.1 Test screener creation with criteria
    - Verify new screener can be created with criteria from criteria builder
    - Test that criteria data is properly converted and saved
    - Ensure form validation works with criteria data
    - Test empty criteria case (screener without criteria)
    - _Requirements: 3.2, 3.4, 3.5_
  - [x] 8.2 Test screener editing with existing criteria
    - Verify existing screener criteria loads properly in criteria builder
    - Test that criteria can be modified and saved
    - Ensure data conversion works in both directions
    - Test edge cases like malformed or missing criteria data
    - _Requirements: 2.1, 2.2, 2.5_
  - [x] 8.3 Test error scenarios and edge cases
    - Test behavior when criteria builder fails to load
    - Verify error handling when data conversion fails
    - Test form behavior with invalid criteria data
    - Ensure graceful degradation when criteria features are unavailable
    - _Requirements: 5.1, 5.2, 5.3, 5.4_

- [x] 9. Verify backward compatibility and clean up
  - [x] 9.1 Test with existing screener data
    - Load existing screeners that were created with query-builder
    - Verify they display and function correctly with criteria-builder
    - Test that existing data can be edited and saved
    - _Requirements: 2.1, 2.2_
  - [x] 9.2 Remove unused query-builder code and dependencies
    - Remove any remaining query-builder imports or references
    - Clean up unused methods related to old query-builder implementation
    - Remove query-builder from package dependencies if not used elsewhere
    - Update any comments or documentation references
    - _Requirements: 1.4_
  - [x] 9.3 Verify application stability
    - Test complete screener workflow (create, edit, delete)
    - Verify no console errors or warnings related to criteria integration
    - Test navigation between tabs and form state preservation
    - Ensure all existing screener functionality still works
    - _Requirements: 3.1, 3.4, 3.5_

- [x] 10. Document MVP implementation and future enhancement points
  - [x] 10.1 Update component documentation
    - Document new criteria-builder integration approach
    - Add comments explaining data conversion methods
    - Document static field configuration setup
    - _Requirements: 7.1, 7.2, 7.3_
  - [x] 10.2 Document future enhancement opportunities
    - Document extension points for API integration
    - Note areas where advanced features can be added
    - Document potential improvements for validation and error handling
    - Create roadmap for incremental feature additions
    - _Requirements: 7.4, 7.5_